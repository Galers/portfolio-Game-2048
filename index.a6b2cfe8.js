class e{constructor(){this.board=this.getState(),this.score=0,this.gameActive=!1,this.cells=document.querySelectorAll(".field-cell"),this.messageWin=document.querySelector(".message-win"),this.messageLose=document.querySelector(".message-lose"),this.assignDataAttributes()}assignDataAttributes(){this.cells.forEach((e,t)=>{e.dataset.row=Math.floor(t/4),e.dataset.col=t%4})}moveUp(){if(!this.gameActive)return;let e=!1;for(let t=0;t<4;t++)this.moveColumnUp(t)&&(e=!0);e&&(this.getRandomTile(),this.addCell()),this.checkGameStatus()}moveDown(){if(!this.gameActive)return;let e=!1;for(let t=0;t<4;t++)this.moveColumnDown(t)&&(e=!0);e&&(this.getRandomTile(),this.addCell()),this.checkGameStatus()}moveLeft(){if(!this.gameActive)return;let e=!1;for(let t=0;t<4;t++)this.moveColumnLeft(t)&&(e=!0);e&&(this.getRandomTile(),this.addCell()),this.checkGameStatus()}moveRight(){if(!this.gameActive)return;let e=!1;for(let t=0;t<4;t++)this.moveColumnRight(t)&&(e=!0);e&&(this.getRandomTile(),this.addCell()),this.checkGameStatus()}getScore(){return this.board.flat().reduce((e,t)=>e+t,0)}getState(){return[void 0,void 0,void 0,void 0].map(()=>[,,,,].fill(0))}getRandomTile(){let e=[];for(let t=0;t<4;t++)for(let s=0;s<4;s++)0===this.board[t][s]&&e.push({row:t,col:s});if(e.length){let{row:t,col:s}=e[Math.floor(Math.random()*e.length)];return this.board[t][s]=.9>Math.random()?2:4,this.animateNewTile(t,s),{row:t,col:s,value:this.board[t][s]}}return null}checkWin(){return this.board.flat().includes(2048)}checkLose(){for(let e=0;e<4;e++)for(let t=0;t<4;t++){if(0===this.board[e][t])return!1;let s=t<3&&this.board[e][t]===this.board[e][t+1],i=e<3&&this.board[e][t]===this.board[e+1][t];if(s||i)return!1}return!0}getStatus(){return this.checkWin()?"win":this.checkLose()?"lose":"playing"}checkGameStatus(){let e=this.getStatus();"win"===e?(this.messageWin.classList.remove("hidden"),this.showWinMessage(),this.showConfetti()):"lose"===e&&(this.messageLose.classList.remove("hidden"),this.showGameOverMessage())}addCell(){this.cells.forEach((e,t)=>{let s=Math.floor(t/4),i=t%4,a=this.board[s][i],o=a?` field-cell--${a}`:"";e.className="field-cell"+o,e.textContent=a||"",this.animateAppear(s,i)})}deleteCell(){this.cells.forEach(e=>{e.className="field-cell",e.textContent=""})}start(e){this.gameActive=!0,this.score=0,e.classList.replace("start","restart"),e.textContent="Restart",this.getRandomTile(),this.getRandomTile(),this.addCell(),this.assignDataAttributes()}restart(e){this.gameActive=!1,this.score=0;let t=this.messageLose.classList.contains("hidden"),s=this.messageWin.classList.contains("hidden");t||this.messageLose.classList.add("hidden"),s||this.messageWin.classList.add("hidden"),e.classList.replace("restart","start"),e.textContent="Start",this.board=this.getState(),this.deleteCell(),this.assignDataAttributes()}moveColumnUp(e){let t=!1,s=this.board.map(t=>t[e]).filter(e=>0!==e);for(let i=0;i<s.length-1;i++)s[i]===s[i+1]&&(s[i]*=2,s.splice(i+1,1),this.score+=s[i],this.animateMerge(i,e),t=!0);for(;s.length<4;)s.push(0);for(let i=0;i<4;i++)this.board[i][e]!==s[i]&&(t=!0),this.board[i][e]=s[i],this.animateMove(i,e);return t}moveColumnDown(e){let t=!1,s=this.board.map(t=>t[e]).filter(e=>0!==e);for(let i=s.length-1;i>0;i--)s[i]===s[i-1]&&(s[i]*=2,s.splice(i-1,1),this.score+=s[i],this.animateMerge(i,e),t=!0);for(;s.length<4;)s.unshift(0);for(let i=0;i<4;i++)this.board[i][e]!==s[i]&&(t=!0),this.board[i][e]=s[i],this.animateMove(i,e);return t}moveColumnLeft(e){let t=!1,s=this.board[e].filter(e=>0!==e);for(let i=0;i<s.length-1;i++)s[i]===s[i+1]&&(s[i]*=2,s.splice(i+1,1),this.score+=s[i],this.animateMerge(e,i),t=!0);for(;s.length<4;)s.push(0);this.board[e].some((e,t)=>e!==s[t])&&(t=!0),this.board[e]=s;for(let t=0;t<4;t++)this.animateMove(e,t);return t}moveColumnRight(e){let t=!1,s=this.board[e].filter(e=>0!==e);for(let i=s.length-1;i>0;i--)s[i]===s[i-1]&&(s[i]*=2,s.splice(i-1,1),this.score+=s[i],this.animateMerge(e,i),t=!0);for(;s.length<4;)s.unshift(0);this.board[e].some((e,t)=>e!==s[t])&&(t=!0),this.board[e]=s;for(let t=0;t<4;t++)this.animateMove(e,t);return t}animateNewTile(e,t){let s=document.querySelector(`.field-cell[data-row="${e}"][data-col="${t}"]`);s&&(s.classList.add("field-cell--new"),setTimeout(()=>{s.classList.remove("field-cell--new")},300))}animateAppear(e,t){let s=document.querySelector(`.field-cell[data-row="${e}"][data-col="${t}"]`);s&&(s.classList.add("field-cell--appear"),setTimeout(()=>{s.classList.remove("field-cell--appear")},200))}animateMerge(e,t){let s=document.querySelector(`.field-cell[data-row="${e}"][data-col="${t}"]`);s&&(s.classList.add("field-cell--merge"),setTimeout(()=>{s.classList.remove("field-cell--merge")},300))}animateMove(e,t){let s=document.querySelector(`.field-cell[data-row="${e}"][data-col="${t}"]`);s&&(s.classList.add("field-cell--move"),setTimeout(()=>{s.classList.remove("field-cell--move")},300))}showGameOverMessage(){let e=document.querySelector(".game-over-overlay");e.classList.remove("hidden"),setTimeout(()=>{e.classList.add("show")},10),setTimeout(()=>{e.classList.remove("show"),setTimeout(()=>{e.classList.add("hidden")},1e3)},3e3)}showWinMessage(){let e=document.querySelector(".win-overlay");e.classList.remove("hidden"),setTimeout(()=>{e.classList.add("show")},10),setTimeout(()=>{e.classList.remove("show"),setTimeout(()=>{e.classList.add("hidden")},1e3)},3e3)}createConfetti=()=>{let e=document.querySelector(".confetti-container"),t=document.createElement("div");t.classList.add("confetti"),t.style.backgroundColor=`hsl(${360*Math.random()}, 100%, 50%)`,t.style.left=`${100*Math.random()}vw`,t.style.animationDelay=`${Math.random()}s`,t.style.animationDuration=`${2*Math.random()+3}s`,e.appendChild(t),setTimeout(()=>{t.remove()},5e3)};showConfetti(){for(let e=0;e<100;e++)this.createConfetti()}}document.addEventListener("DOMContentLoaded",()=>{let t=new e,s=document.querySelector(".button"),i=document.querySelector(".game-score"),a=document.querySelector(".message-start"),o=()=>window.addEventListener("keydown",r,{once:!0}),l=()=>{i.textContent=t.getScore()},r=e=>{switch(e.key){case"ArrowUp":t.moveUp();break;case"ArrowDown":t.moveDown();break;case"ArrowLeft":t.moveLeft();break;case"ArrowRight":t.moveRight();break;default:o();return}l(),o()};o(),s.addEventListener("click",()=>{if(s.classList.contains("start"))t.start(s),a.classList.add("hidden");else{if(!confirm("Are you sure you want to start a new game? All progress will be lost."))return;t.restart(s),t.start(s)}l(),o()})});
//# sourceMappingURL=index.a6b2cfe8.js.map
